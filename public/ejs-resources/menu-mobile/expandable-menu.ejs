<% var rootPath = '../../'; %>
<script src="/scripts/auth/sign-out.js"></script>
<script src="/scripts/alerts/page-alerts.js"></script>
<%- include(rootPath + 'ejs-resources/menu-mobile/menu_style.ejs') %> 
<div class="expandible-menu-invisible" id="expandible-menu">
    <div class="expandible-menu-option-cont" id="name-option-exp-menu">
        <img loading="lazy" class="" id="profile-pic-exp-menu" src=<%=photoUrl %> alt="profile pic" style="height: 55px; width:
        55px; cursor: pointer; margin-right: 10px; user-select: none; border-radius: 80px; object-fit: cover">
        <a id="exp-menu-name">
            <%= displayName %>
        </a>

        <% if (!isPrivate) {%>
            <div id="notifications-icon-container-menu">
                <svg id="notifications-icon-menu" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"></svg>
                <script>
                    if(isNotificationAllowed()) {
                        document.getElementById("notifications-icon-menu").innerHTML = '';
                    } else {
                        document.getElementById("notifications-icon-menu").innerHTML = '<path d="M12 1c3.681 0 7 2.565 7 6v4.539c0 .642.189 1.269.545 1.803l2.2 3.298A1.517 1.517 0 0 1 20.482 19H15.5a3.5 3.5 0 1 1-7 0H3.519a1.518 1.518 0 0 1-1.265-2.359l2.2-3.299A3.25 3.25 0 0 0 5 11.539V7c0-3.435 3.318-6 7-6ZM6.5 7v4.539a4.75 4.75 0 0 1-.797 2.635l-2.2 3.298-.003.01.001.007.004.006.006.004.007.001h16.964l.007-.001.006-.004.004-.006.001-.006a.017.017 0 0 0-.003-.01l-2.199-3.299a4.753 4.753 0 0 1-.798-2.635V7c0-2.364-2.383-4.5-5.5-4.5S6.5 4.636 6.5 7ZM14 19h-4a2 2 0 1 0 4 0Z"></path>';
                        document.getElementById("notifications-icon-menu").addEventListener("click", () => {
                            allowNotifications().then(allowed => {
                                if(allowed) {
                                    document.getElementById("notifications-icon-menu").innerHTML = '';
                                } else {
                                    document.getElementById("notifications-icon-menu").innerHTML = '<path d="M12 1c3.681 0 7 2.565 7 6v4.539c0 .642.189 1.269.545 1.803l2.2 3.298A1.517 1.517 0 0 1 20.482 19H15.5a3.5 3.5 0 1 1-7 0H3.519a1.518 1.518 0 0 1-1.265-2.359l2.2-3.299A3.25 3.25 0 0 0 5 11.539V7c0-3.435 3.318-6 7-6ZM6.5 7v4.539a4.75 4.75 0 0 1-.797 2.635l-2.2 3.298-.003.01.001.007.004.006.006.004.007.001h16.964l.007-.001.006-.004.004-.006.001-.006a.017.017 0 0 0-.003-.01l-2.199-3.299a4.753 4.753 0 0 1-.798-2.635V7c0-2.364-2.383-4.5-5.5-4.5S6.5 4.636 6.5 7ZM14 19h-4a2 2 0 1 0 4 0Z"></path>';
                                }
                            })
                        });
                    }

                    navigator.permissions.query({name: "notifications"}).then(np => {
                        np.onchange = () => {
                            if(isNotificationAllowed()) {
                                document.getElementById("notifications-icon-menu").innerHTML = '';
                            } else {
                                document.getElementById("notifications-icon-menu").innerHTML = '<path d="M12 1c3.681 0 7 2.565 7 6v4.539c0 .642.189 1.269.545 1.803l2.2 3.298A1.517 1.517 0 0 1 20.482 19H15.5a3.5 3.5 0 1 1-7 0H3.519a1.518 1.518 0 0 1-1.265-2.359l2.2-3.299A3.25 3.25 0 0 0 5 11.539V7c0-3.435 3.318-6 7-6ZM6.5 7v4.539a4.75 4.75 0 0 1-.797 2.635l-2.2 3.298-.003.01.001.007.004.006.006.004.007.001h16.964l.007-.001.006-.004.004-.006.001-.006a.017.017 0 0 0-.003-.01l-2.199-3.299a4.753 4.753 0 0 1-.798-2.635V7c0-2.364-2.383-4.5-5.5-4.5S6.5 4.636 6.5 7ZM14 19h-4a2 2 0 1 0 4 0Z"></path>';
                                
                            }
                        }
                    })

                    
                </script>
            </div>
        <% } %>  
    </div>
    <ul class="exp-options-container">
        <span class="menu-line-separator"></span>
        <li>
            <a href="/inicio" class="menu-option">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" fill="#333" height="24"> <path fill-rule="evenodd" d="M11.03 2.59a1.5 1.5 0 011.94 0l7.5 6.363a1.5 1.5 0 01.53 1.144V19.5a1.5 1.5 0 01-1.5 1.5h-5.75a.75.75 0 01-.75-.75V14h-2v6.25a.75.75 0 01-.75.75H4.5A1.5 1.5 0 013 19.5v-9.403c0-.44.194-.859.53-1.144l7.5-6.363zM12 3.734l-7.5 6.363V19.5h5v-6.25a.75.75 0 01.75-.75h3.5a.75.75 0 01.75.75v6.25h5v-9.403L12 3.734z"> </path> </svg>
                <span>Inicio</span>
            </a>
        </li>
        <li>
            <a href="/alertas" class="menu-option">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#333" width="24" height="24"> <path d="M12 13.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path> <path fill-rule="evenodd" d="M19.071 3.429C15.166-.476 8.834-.476 4.93 3.429c-3.905 3.905-3.905 10.237 0 14.142l.028.028 5.375 5.375a2.359 2.359 0 003.336 0l5.403-5.403c3.905-3.905 3.905-10.237 0-14.142zM5.99 4.489A8.5 8.5 0 0118.01 16.51l-5.403 5.404a.859.859 0 01-1.214 0l-5.378-5.378-.002-.002-.023-.024a8.5 8.5 0 010-12.02z"> </path> </svg>
                <span>Alertas</span>
            </a>
        </li>
        <span class="menu-line-separator"></span>

        <li>
            <% if (isPrivate) {%> 
                <a href="/signin" class="menu-option">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#333" width="24" height="24"> <path fill-rule="evenodd" d="M12 2.5a5.5 5.5 0 00-3.096 10.047 9.005 9.005 0 00-5.9 8.18.75.75 0 001.5.045 7.5 7.5 0 0114.993 0 .75.75 0 101.499-.044 9.005 9.005 0 00-5.9-8.181A5.5 5.5 0 0012 2.5zM8 8a4 4 0 118 0 4 4 0 01-8 0z"> </path> </svg>
                    <span>Iniciar Sesión</span>
                </a>
            <% } else { %>
                <a href="/perfil/<%= uid %>" class="menu-option">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#333" width="24" height="24"> <path fill-rule="evenodd" d="M12 2.5a5.5 5.5 0 00-3.096 10.047 9.005 9.005 0 00-5.9 8.18.75.75 0 001.5.045 7.5 7.5 0 0114.993 0 .75.75 0 101.499-.044 9.005 9.005 0 00-5.9-8.181A5.5 5.5 0 0012 2.5zM8 8a4 4 0 118 0 4 4 0 01-8 0z"> </path> </svg>
                    <span>Perfil</span>
                </a>
            <% } %> 
        </li>

        <% if (!isPrivate) {%>
            <li>
                <a href="" class="menu-option">
                    <svg fill="#333" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"> <path fill-rule="evenodd" d="M0 4.75C0 3.784.784 3 1.75 3h20.5c.966 0 1.75.784 1.75 1.75v14.5A1.75 1.75 0 0122.25 21H1.75A1.75 1.75 0 010 19.25V4.75zm1.75-.25a.25.25 0 00-.25.25v14.5c0 .138.112.25.25.25h20.5a.25.25 0 00.25-.25V4.75a.25.25 0 00-.25-.25H1.75z"> </path> <path fill-rule="evenodd" d="M5 8.75A.75.75 0 015.75 8h11.5a.75.75 0 010 1.5H5.75A.75.75 0 015 8.75zm0 4a.75.75 0 01.75-.75h5.5a.75.75 0 010 1.5h-5.5a.75.75 0 01-.75-.75z"> </path> </svg>
                    <span>Mis Datos</span>
                </a>
            </li>
        <span class="menu-line-separator"></span>

        <% } %> 

        <% if (!isPrivate) {%> 
            <% if (userData.Type.TypeNum !== 1) {%> 
                <li>
                    <a href="/perfil/lista/borradores" class="menu-option">
                        <svg fill="#333" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"> <path fill-rule="evenodd" d="M17.263 2.177a1.75 1.75 0 012.474 0l2.586 2.586a1.75 1.75 0 010 2.474L19.53 10.03l-.012.013L8.69 20.378a1.75 1.75 0 01-.699.409l-5.523 1.68a.75.75 0 01-.935-.935l1.673-5.5a1.75 1.75 0 01.466-.756L14.476 4.963l2.787-2.786zm-2.275 4.371l-10.28 9.813a.25.25 0 00-.067.108l-1.264 4.154 4.177-1.271a.25.25 0 00.1-.059l10.273-9.806-2.94-2.939zM19 8.44l2.263-2.262a.25.25 0 000-.354l-2.586-2.586a.25.25 0 00-.354 0L16.061 5.5 19 8.44z"> </path> </svg>
                        <span>Borradores</span>
                    </a>
                </li>
            <% } %> 

            <li>
                <a href="/favoritos" class="menu-option">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#333" width="24" height="24"> <path fill-rule="evenodd" d="M6.736 4C4.657 4 2.5 5.88 2.5 8.514c0 3.107 2.324 5.96 4.861 8.12a29.66 29.66 0 004.566 3.175l.073.041.073-.04c.271-.153.661-.38 1.13-.674.94-.588 2.19-1.441 3.436-2.502 2.537-2.16 4.861-5.013 4.861-8.12C21.5 5.88 19.343 4 17.264 4c-2.106 0-3.801 1.389-4.553 3.643a.75.75 0 01-1.422 0C10.537 5.389 8.841 4 6.736 4zM12 20.703l.343.667a.75.75 0 01-.686 0l.343-.667zM1 8.513C1 5.053 3.829 2.5 6.736 2.5 9.03 2.5 10.881 3.726 12 5.605 13.12 3.726 14.97 2.5 17.264 2.5 20.17 2.5 23 5.052 23 8.514c0 3.818-2.801 7.06-5.389 9.262a31.146 31.146 0 01-5.233 3.576l-.025.013-.007.003-.002.001-.344-.666-.343.667-.003-.002-.007-.003-.025-.013A29.308 29.308 0 0110 20.408a31.147 31.147 0 01-3.611-2.632C3.8 15.573 1 12.332 1 8.514z"> </path></svg>
                    <span>Favoritos</span>
                </a>
            </li>

            <li>
                <a href="/chats" class="menu-option">
                    <svg fill="#333" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M1.75 1h12.5c.966 0 1.75.784 1.75 1.75v9.5A1.75 1.75 0 0114.25 14H8.061l-2.574 2.573A1.458 1.458 0 013 15.543V14H1.75A1.75 1.75 0 010 12.25v-9.5C0 1.784.784 1 1.75 1zM1.5 2.75v9.5c0 .138.112.25.25.25h2a.75.75 0 01.75.75v2.19l2.72-2.72a.749.749 0 01.53-.22h6.5a.25.25 0 00.25-.25v-9.5a.25.25 0 00-.25-.25H1.75a.25.25 0 00-.25.25z"></path><path d="M22.5 8.75a.25.25 0 00-.25-.25h-3.5a.75.75 0 010-1.5h3.5c.966 0 1.75.784 1.75 1.75v9.5A1.75 1.75 0 0122.25 20H21v1.543a1.457 1.457 0 01-2.487 1.03L15.939 20H10.75A1.75 1.75 0 019 18.25v-1.465a.75.75 0 011.5 0v1.465c0 .138.112.25.25.25h5.5a.75.75 0 01.53.22l2.72 2.72v-2.19a.75.75 0 01.75-.75h2a.25.25 0 00.25-.25v-9.5z"></path></svg>
                    <span>Chats</span>
                </a>
            </li>

            <span class="menu-line-separator"></span>
            <% if (userData.Type.TypeNum !== 1) {%> 
                <li>
                    <a onclick="createDraft()" class="menu-option">
                        <svg fill="#333" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M12.75 7.75a.75.75 0 00-1.5 0v3.5h-3.5a.75.75 0 000 1.5h3.5v3.5a.75.75 0 001.5 0v-3.5h3.5a.75.75 0 000-1.5h-3.5v-3.5z"></path><path fill-rule="evenodd" d="M12 1C5.925 1 1 5.925 1 12s4.925 11 11 11 11-4.925 11-11S18.075 1 12 1zM2.5 12a9.5 9.5 0 1119 0 9.5 9.5 0 01-19 0z"></path></svg>
                        <span>Publicar</span>
                    </a>
                </li>
                <span class="menu-line-separator"></span>
            <% } %> 
        <% } %>
        <li>
            <% if (!isPrivate) { %>
                <a onclick="signOut()" style="cursor: pointer">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#ff0000" width="24" height="24"> <path fill-rule="evenodd" d="M3 3.25c0-.966.784-1.75 1.75-1.75h5.5a.75.75 0 010 1.5h-5.5a.25.25 0 00-.25.25v17.5c0 .138.112.25.25.25h5.5a.75.75 0 010 1.5h-5.5A1.75 1.75 0 013 20.75V3.25zm16.006 9.5l-3.3 3.484a.75.75 0 001.088 1.032l4.5-4.75a.75.75 0 000-1.032l-4.5-4.75a.75.75 0 00-1.088 1.032l3.3 3.484H10.75a.75.75 0 000 1.5h8.256z"> </path> </svg>
                    <span style="color: #ff0000">Cerrar sesión</span>
                </a>
            <% } %> 
        </li>
    </ul>
</div>

<script>
    const menuOptions = document.querySelectorAll('.menu-option');
    const targetOption = Number('<%= locals.active %>');
    
    const selectOption = (option) => {
        menuOptions.forEach(option => {
        option.classList.remove('active');
        if (option === menuOptions[targetOption]) {
            option.classList.add('active');
        }
    });
    }
    const expandMenu = () => {
        console.log("menu-hover")
        if (document.getElementById("expandible-menu").className === 'expandible-menu-invisible') {
            document.getElementById("expandible-menu").className = 'expandible-menu-visible';
            document.body.style.overflow = 'hidden';
        } else {
            document.getElementById("expandible-menu").className = 'expandible-menu-invisible';
            document.body.style.overflow = 'visible';
        }
    }

    selectOption(targetOption);

</script>
<script>
    if (typeof createDraft === 'undefined') {
        const createDraft = () => {
            Swal.fire({
                heightAuto: false,
                title: 'Creando borrador',
                allowOutsideClick: false,
                allowEscapeKey: false,
                allowEnterKey: false,
                showConfirmButton: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            })
            axios.post(`https://${window.location.host}/create/publication/draft`)
                .then(function (response) {
                    const data = response.data || {};
                    console.log(data);
                    const id = data.id || '';
                    const redirectPath = data.redirectPath || '';
                    window.location.href = redirectPath;
                })
                .catch(function (error) {
                    console.log(error);
                });
        }
    }

</script>